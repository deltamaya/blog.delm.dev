---
title: YUV 色彩模型  
date: 2024-09-21  
tags: ['philosophy', 'psychology']
authors: ['Maya']  
ai: true
---

**YCbCr 色彩空間**，也常被稱為**YUV 色彩空間**，是一種用於數位電視的色彩空間。  
該模型在 ITU-R BT.601、BT.709、BT.2020 標準中被明確定義，這三種標準分別針對標清、高清與超高清數位電視。

**Y 代表亮度，Cb（U）與 Cr（V）則分別表示色度，描述顏色的色調與飽和度。**  
其中，**Cr 反映了 RGB 色彩模型中紅色成分與 Y（亮度值）之間的差異**，  
**而 Cb 則反映了藍色成分與亮度值之間的差異**。  
在廣播電視中，使用 YCbCr 能解決黑白電視與彩色電視之間的信號兼容問題。

由於人眼對**色度變化不如對亮度變化敏感**，在圖像質量損失幾乎可忽略的前提下，  
可以降低 Cb 與 Cr 通道的取樣率，從而有效壓縮這些通道的數據量，使得圖像數據佔用更少空間。  
常見的 YCbCr 取樣格式包括：

- **4:4:4**，每像素約佔用 3 字節  
- **4:2:2**，每像素約佔用 2 字節  
- **4:2:0**，每像素約佔用 1.5 字節  

![yuv-intro](/media-processing/yuv-intro.png)

### YUV444

YUV4:4:4 在存儲格式上與 RGB 圖像存儲方法一致，  
Y、U、V 三個分量連續存放，如下圖所示：  
![yuv-layout](/media-processing/yuv-layout.png)

---

YUV 格式有以下三種類型：

1. **Planar（平面格式）**：Y 分量先連續存儲所有像素的數據，緊接著存儲所有像素的 U，然後是 V。  
2. **Semi-Planar（半平面格式）**：Y 分量獨立存儲，而 UV 分量交叉存儲。  
3. **Packed（打包格式）**：每個像素的 Y、U、V 值交錯存儲。  

> **注意**：所謂的“連續存儲”並不是指每一行像素內的連續，而是整張圖片的連續存儲。  
> 舉例來說，本文中的 `out444.yuv` 圖片大小為 16875Kb，  
> 那麼第 1 ~ 5625Kb 是 Y 數據，第 5626 ~ 11250Kb 是 U 數據，以此類推。

當使用 `FFmpeg` 命令將 JPEG 轉換為 YUV 格式時，  
常用的格式為 `yuv444p`，其中 `p` 表示 **Planar 格式**。  
YUV 圖片的像素存儲順序是從左上角到右下角的。  
因此，若要將左上角的三個像素改為白色，只需將前 3 個字節的值設為 255。  
如下圖所示：  
![](/media-processing/yuv-edit.png)  

打開圖片即可看到左上角的三個像素已變成白色：  
![](/media-processing/yuv-edit-demo.png)  

---

### YUV422

在 YUV 轉換 RGB 時，需知道 Y、U 和 V 的值。當 UV 僅有一半數據時，該如何處理？  
答案是**像素共享**，即兩個像素共用一組 UV 值。

在 YUV422 格式中，U 值通過取兩個像素的 U 值平均來生成。  
因此，每對像素共用一組 UV，以此類推，如下圖所示：

![yuv422-sample](uploaded-image-1.png)

### YUV420

YUV420 格式數據量最少，應用最廣泛（如視頻會議、數位電視、DVD 等）。  
下圖展示了其數據排列方式：

![yuv420-sample](uploaded-image-2.png)

在此格式中，每四個像素共用一組 UV 值，這種設計使畫面過渡更加自然。  
具體而言，有多種算法計算 UV 值：  

1. **取平均值**：將四個像素的 U 值加總後平均。  
2. **加權平均**：對第一、第二像素賦予更高權重。  
3. **直接取值**：丟棄後三個像素的 U 值，只取第一個像素的 U 值。  

FFmpeg 使用的是**取平均值**的方法，這在大多數情況下最為可靠。

---

## RGB 與 YUV 的轉換

RGB 與 YUV 模型之間可以相互轉換。根據 BT.2020（超高清數位電視標準），轉換公式如下：

$$
\begin{bmatrix}
R \\
G \\
B
\end{bmatrix}
=
\begin{bmatrix}
1 & 0 & 1.4746 \\
1 & -0.16455312684366 & -0.57135312684366 \\
1 & 1.8814 & 0
\end{bmatrix}
\begin{bmatrix}
Y' \\
C_B \\
C_R
\end{bmatrix}
$$

---

## 實驗：不同 YUV 格式對比

我們將同一張 3200×1800 的圖片分別轉換為 YUV444、YUV422 和 YUV420 格式，  
命令如下：

```
ffmpeg -i .\275386.jpg -s 3200*1800 -pix_fmt yuv444p out444.yuv
ffmpeg -i .\275386.jpg -s 3200*1800 -pix_fmt yuv422p out422.yuv
ffmpeg -i .\275386.jpg -s 3200*1800 -pix_fmt yuv420p out420.yuv
```

轉換後，文件大小與清晰度對比如下：

### 文件大小比較

YUV420 文件：**文件大小僅為 YUV444 的一半**。

![yuv-file-info](uploaded-image-3.png)

### 圖像清晰度比較

以下為 YUV422 與 YUV444 圖片的實際效果對比：  
**YUV422 圖片**  
![yuv422-demo](uploaded-image-4.png)  

**YUV444 圖片**  
![yuv444-demo](uploaded-image-5.png)  

> 經觀察，兩者清晰度幾乎沒有差別，  
> 但 YUV422 的數據量僅為 YUV444 的三分之二。  

此外，由於視頻編碼多採用 YUV420，  
我們平時所說的視頻分辨率實際上是指亮度（Y）分辨率，因為 UV 是共享的。

