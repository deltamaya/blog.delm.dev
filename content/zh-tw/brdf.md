---
title: 雙向反射分布函數基礎
date: 2025-02-24
tags: ['graphics', 'lighting', 'mathematics']
authors: ['Maya']
ai: True
draft: False
---
## 定義
**BRDF**(Bidirectional Reflectance Distribution Function, 雙向反射分布函數)是計算機圖形學中一個核心概念，用於描述物體表面如何反射光線。它在真實渲染中扮演著關鍵角色，幫助我們模擬光線與物體表面的複雜互動，從而生成逼真的圖像。

它可以在計算機圖形學中用在全局光照算法中，比如光線追蹤需要計算物體的反射。可以用於材質建模，使用不同的BRDF來模擬不同的材質。還有即時渲染，比如遊戲中計算光照，但BRDF的開銷一般較大，通常使用近似和預計算。

它是一個數學函數，描述了從任意一點和方向入射後，在某一個角度出射的光照強度。BRDF可以通過如下函數來描述：

$$
f_r(\omega_i,\omega_r)=\frac{dL_r(\omega_r)}{dE_i(\omega_i)}=\frac{dL_r(\omega_r)}{L_i(\omega_i)cos\theta_id\omega_i}
$$

其中$\omega_i$表述入射方向，$\omega_r$表示出射方向。

$L_r(\omega_r)$表示在出射輻射亮度，即從出射方向離開的光的輻射亮度，**輻射亮度**(radiance)指的是單位面積，單位立體角內的光功率，單位為$W/(m^2\cdot sr)$。 
$E_i(\omega_i)$表示在入射輻照度，即從入射方向照射到表面上的光功率密度。**輻照度**(irradiance)是單位面積上的光功率，單位是$W/m^2$。

$\theta_i$指的是入射方向與表面法線的夾角。$d\omega_i$是微分立體角。

> [!NOTE]
> 由於BRDF只關心這兩個光線方向，而一個方向上的總光線強度可以有多個入射光線影響，因此我們使用它們微分的比值而非直接進行數值比對，因為微分可以準確地描述當前方向入射光線如何影響出射光線。如果使用數值直接進行比對就會引入其他方向光線的貢獻，導致錯誤。

每個方向可以由極角$\theta$和方位角$\phi$表示。

方位角的取值範圍是$[0,2\pi]$，它表示以觀察者為中心從北方(某個軸)，旋轉角的度數。

極角的取值範圍是$[0,\pi]$，表示在這個方向上的俯仰程度。

如果使用歐拉角來進行類比，方位角約等於Yaw，極角約等於Pitch。

因此BRDF也可以通過如下四元函數表示：

$$
f_r(\theta_i,\phi_i,\theta_r,\phi_r)
$$

BRDF的單位是$sr^{-1}$，表示反射光線在出射方向上的輻射強度與入射光線在入射方向輻射強度的比值。

## 物理意義
由於BRDF表示的是現實中的光照反射情況，因此必須遵循能量守恆等物理規律，因此BRDF有如下約束：
- 非負: 反射光線的強度不能為負數
- 可逆: 將入射角和反射角顛倒產生的結果應該相同，光線可逆
- 能量守恆: 對於一個入射方向，所有出射方向的光照強度的積分需要小於1

通過BRDF我們可以計算出一個物體對光線的反射情況，根據物體的不同BRDF，可以表現出不同的外觀：
- 鏡面: BRDF在出射方向上有一個尖峰
- 漫反射: BRDF在各個方向上近乎相等
- 光澤表面: BRDF在某一段區間上有較寬的峰值

## 限制
BRDF的計算開銷較大，通常使用預計算或者近似模型，比如[Phong模型](https://en.wikipedia.org/wiki/Phong_reflection_model): 風氏光照可以通過環境光、漫反射和鏡面反射模擬BRDF。