---
title: ArcVP DevLog#3
date: 2024-10-08
tags: ['graphics','devlog','opengl','ffmpeg','media-processing','arcvp']
authors: ['Maya']
ai: true
---

# 進度

經過一週的假期後，我重新開始投入這個專案的工作。不過，我發現使用 `FFmpeg` 建立一個功能齊全的影片編輯器比我最初預期的要更為複雜。鑑於這些挑戰，我決定簡化專案範圍，專注於創建一個影片播放器，而不是影片編輯器。

目前的進度是，我已經實現了搜尋功能，使用 `AVSEEK_BACKWARD` 標誌讓播放器能夠跳轉到最近的關鍵幀（keyframe）。此外，我還新增了一個控制面板，讓使用者在播放影片時能夠更輕鬆直觀地操作。

## 概念

自從上次的開發日誌以來，我一直在進行搜尋功能的開發，並在過程中遇到了一些挑戰。

## av_seek_frame

FFmpeg 提供了一個方便的 API，稱為 `av_seek_frame`，它允許你指定目標位置的 PTS（呈現時間戳），並指示解封裝器和解碼器跳轉到該位置。然而，這個過程中有一些陷阱需要注意。

## 搜尋標誌

我遇到的第一個問題與搜尋標誌有關。在呼叫 `av_seek_frame` 後，如果你沒有提供標誌（或使用空的標誌）並嘗試向前搜尋，則什麼也不會發生。另一方面，如果你提供了 `AVSEEK_BACKWARD` 標誌，播放器會跳轉到指定時間之前的最近 **關鍵幀**，這意味著搜尋會略微落後於預期位置。使用 `AVSEEK_ANY` 可以搜尋到確切位置，但會引入一些複雜性。為了簡單起見，我決定暫時專注於關鍵幀搜尋。

# SDL + ImGui
最初，我嘗試了幾種將 Dear ImGui 與 SDL 整合的方法，但在渲染器上將 ImGui 視窗顯示在影片材質（texture）之上時遇到了困難。在網上搜尋解決方案後，我發現了一個非常符合需求的小型函式庫：[imgui_sdl](https://github.com/Tyyppi77/imgui_sdl)。有了這個庫，我成功實現了一個基本的影片播放控制面板。不過，仍然存在一些錯誤需要修正。

![demo](/devlog/devlog3-demostrate.png)
